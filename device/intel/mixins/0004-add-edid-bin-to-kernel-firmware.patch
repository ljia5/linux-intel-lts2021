From 5b5386976030019b89f74583fc7ac7160192287f Mon Sep 17 00:00:00 2001
From: kanlihu <kanli.hu@intel.com>
Date: Tue, 26 Sep 2023 21:23:01 +0800
Subject: [PATCH] add edid bin to kernel firmware

add edid to kernel firmware
make DP-2 load 1080p edid

Tracked-On: OAM-112349
Signed-off-by: Kanli Hu <kanli.hu@intel.com>
---
 groups/graphics/auto/AndroidBoard.mk                          | 4 ++++
 .../gmin64/config-lts/linux-intel-lts2021/x86_64_defconfig    | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/groups/graphics/auto/AndroidBoard.mk b/groups/graphics/auto/AndroidBoard.mk
index 9354922..b1124ba 100644
--- a/groups/graphics/auto/AndroidBoard.mk
+++ b/groups/graphics/auto/AndroidBoard.mk
@@ -1,6 +1,7 @@
 {{#gen9+}}
 
 I915_FW_PATH := vendor/linux/firmware/i915
+I915_EDID_PATH := vendor/linux/firmware/edid
 
 # List of i915/guc_xxx.bin
 $(foreach t, $(patsubst $(I915_FW_PATH)/%,%,$(wildcard $(I915_FW_PATH)/kbl_guc_70*)) ,$(eval I915_FW += i915/$(t)) $(eval $(LOCAL_KERNEL) : $(PRODUCT_OUT)/vendor/firmware/i915/$(t)))
@@ -30,6 +31,9 @@ $(foreach t, $(patsubst $(I915_FW_PATH)/%,%,$(wildcard $(I915_FW_PATH)/adlp_dmc*
 $(foreach t, $(patsubst $(I915_FW_PATH)/%,%,$(wildcard $(I915_FW_PATH)/adls_dmc*)) ,$(eval I915_FW += i915/$(t)) $(eval $(LOCAL_KERNEL) : $(PRODUCT_OUT)/vendor/firmware/i915/$(t)))
 $(foreach t, $(patsubst $(I915_FW_PATH)/%,%,$(wildcard $(I915_FW_PATH)/dg2_dmc*)) ,$(eval I915_FW += i915/$(t)) $(eval $(LOCAL_KERNEL) : $(PRODUCT_OUT)/vendor/firmware/i915/$(t)))
 
+#list of edid/*.bin
+$(foreach t, $(patsubst $(I915_EDID_PATH)/%,%,$(wildcard $(I915_EDID_PATH)/*)) ,$(eval I915_FW += edid/$(t)) $(eval $(LOCAL_KERNEL) : $(PRODUCT_OUT)/vendor/firmware/edid/$(t)))
+
 _EXTRA_FW_ += $(I915_FW)
 
 AUTO_IN += $(TARGET_DEVICE_DIR)/{{_extra_dir}}/auto_hal.in
diff --git a/groups/kernel/gmin64/config-lts/linux-intel-lts2021/x86_64_defconfig b/groups/kernel/gmin64/config-lts/linux-intel-lts2021/x86_64_defconfig
index 578052a..cffe903 100644
--- a/groups/kernel/gmin64/config-lts/linux-intel-lts2021/x86_64_defconfig
+++ b/groups/kernel/gmin64/config-lts/linux-intel-lts2021/x86_64_defconfig
@@ -4250,7 +4250,7 @@ CONFIG_DRM_KMS_HELPER=y
 CONFIG_DRM_FBDEV_EMULATION=y
 CONFIG_DRM_FBDEV_OVERALLOC=100
 # CONFIG_DRM_FBDEV_LEAK_PHYS_SMEM is not set
-# CONFIG_DRM_LOAD_EDID_FIRMWARE is not set
+CONFIG_DRM_LOAD_EDID_FIRMWARE=y
 # CONFIG_DRM_DP_CEC is not set
 CONFIG_DRM_TTM=y
 CONFIG_DRM_VRAM_HELPER=y
-- 
2.40.0

